\begin{itemframe}{مسئله ازدواج پایدار}
\item[-]
در بخش قبلی، هدف یافتن یک تطابق بیشینه در یک گراف دوبخشی بدون جهت بود.
اگر بدانیم که گرافی دوبخشی کامل است (یعنی از هر رأس در $L$ به همه رئوس در $R$ یال وجود دارد) آنگاه می‌توان با یک الگوریتم حریصانهٔ ساده یک تطابق بیشینه یافت.
\item[-]
زمانی که یک گراف می‌تواند چندین تطابق مختلف داشته باشد، ممکن است بخواهیم تعیین کنیم که کدام تطابق‌ها مطلوب‌تر هستند. در بخش آینده، به یال‌ها وزن اضافه خواهیم کرد و تطابقی با بیشینه وزن را می‌یابیم.
\item[-]
اما در این بخش، به جای آن، به هر رأس در یک گراف دوبخشی کامل اطلاعاتی اضافه می‌کنیم: رتبه‌بندی رأس‌های سمت مقابل. به‌عبارت‌دیگر، هر رأس در $L$ یک فهرست مرتب از تمام رأس‌های $R$ دارد، و برعکس. برای ساده نگه داشتن بحث، فرض می‌کنیم که هر یک از مجموعه‌های $L$ و $R$ شامل $n$ رأس هستند. هدف در اینجا یافتن یک تطابق بین رأس‌های $L$ و $R$ به‌گونه‌ای «پایدار» است.
\end{itemframe}


\begin{itemframe}{مسئله ازدواج پایدار}
\item[-]
این مسئله به نام مسئله ازدواج پایدار
\fn{1}{stable-marriage problem}
شناخته می‌شود به‌طوری که $L$ مجموعه‌ای از زنان و $R$ مجموعه‌ای از مردان است. هر زن، تمام مردان را  رتبه‌بندی می‌کند و هر مرد نیز تمام زنان را رتبه‌بندی می‌کند.
\item[-]
هدف، یافتن تطابق به گونه‌ای است که اگر زن و مردی با یکدیگر زوج نشده‌اند، آنگاه حداقل یکی از آن‌ها شریک تخصیص‌یافته‌اش را ترجیح دهد.
\item[-]
اگر زنی و مردی با یکدیگر زوج نشده باشند اما هر یک، دیگری را به شریک تخصیص‌یافته‌اش ترجیح دهد، آن‌ها یک «زوج مسدودکننده»
\fn{1}{blocking pair}
را تشکیل می‌دهند. یک زوج مسدودکننده انگیزه دارد که از ازدواج تعیین شده خارج شده و با یکدیگر جفت شوند. در این صورت، این زوج پایداری تطابق را «مسدود» می‌کنند.
\item[-]
یک تطابق پایدار، تطابقی است که هیچ زوج مسدودکننده‌ای ندارد.
\end{itemframe}


\begin{itemframe}{مسئله ازدواج پایدار}
\item[-]
تعداد پاسخ‌ها به یک مسئله ازدواج پایدار الزاماً یکتا نیست. امّا آیا همیشه حداقل یک تطابق پایدار وجود دارد؟ پاسخ این پرسش، مثبت است. بنابراین همیشه یک یا چند تطابق پایدار وجود دارد.

\item[-]
یک الگوریتم ساده به نام الگوریتم گیل-شپلی
\fn{1}{Gale–Shapley}
همواره یک تطابق پایدار پیدا می‌کند. این الگوریتم دو نسخه «زن‌محور»
\fn{2}{woman-oriented}
و «مرد‌محور»
\fn{3}{man-oriented}
دارد. در اینجا نسخه‌ی زن‌محور را بررسی می‌کنیم.
\item[-]
هر شرکت‌کننده یا مزدوج است یا آزاد و همه افراد در ابتدا آزاد هستند.
وضعیت مزدوج زمانی اتفاق می‌افتد که زنی آزاد به مردی پیشنهاد دهد.
\end{itemframe}


\begin{itemframe}{مسئله ازدواج پایدار}
\item[-]
هنگامی که مردی برای اولین بار پیشنهادی دریافت می‌کند، وضعیتش از آزاد به مزدوج تغییر می‌یابد و از آن پس همیشه مزدوج باقی می‌ماند—هرچند نه لزوماً با همان زن.
\item[-]
 اگر مردی مزدوج پیشنهادی از زنی دریافت کند که او را به زنی که در حال حاضر با او زوج است ترجیح دهد، آن زوج شکسته می‌شود، زنی که قبلاً با او مزدوج بوده آزاد می‌شود، و مرد با زنی که بیشتر ترجیح داد زوج می‌شود.

\item[-]
هر زن به ترتیب به مردان موجود در فهرستش پیشنهاد می‌دهد، تا زمانی که مزدوج شود. زمانی که زنی مزدوج است، موقتاً از پیشنهاد دادن دست می‌کشد؛ اما اگر دوباره آزاد شود، فرآیند را از همان‌جایی که متوقف شده بود ادامه می‌دهد.
\item[-]
زمانی که همه افراد مزدوج شوند، الگوریتم پایان می‌یابد.
\end{itemframe}


\begin{itemframe}{مسئله ازدواج پایدار}
\item[-]
شبه کد زیر این روش را به صورت دقیق‌تر توضیح می‌دهد:
\begin{algorithm}[H]\alglr
\caption{GALE-SHAPLEY (men, women, rankings)}
\begin{algorithmic}[1]
\State Assign each woman and man as free
\While{some woman $w$ is free}
    \State Let $m$ be the first man on $w$’s list to whom she hasn't proposed
    \If{$m$ is free}
        \State $w$ and $m$ become engaged to each other (and not free)
    \ElsIf{$m$ ranks $w$ higher than his currently engaged woman}
        \State $m$ breaks the engagement to $w'$, who becomes free
        \State $w$ and $m$ become engaged to each other (and not free)
    \Else
        \State $m$ rejects $w$, with $w$ remaining free
    \EndIf
\EndWhile
\State \Return the stable matching consisting of the engaged pairs
\end{algorithmic}
\end{algorithm}

\end{itemframe}


\begin{itemframe}{مسئله ازدواج پایدار}
\item[-]
در خط ۲ می‌توان هر زن آزادی را انتخاب کرد. خواهیم دید که این روش صرف‌نظر از ترتیب انتخاب زنان آزاد، همواره یک تطابق پایدار تولید می‌کند.
\item[-]
‌می‌خواهیم ثابت کنیم الگوریتم GALE-SHAPLEY همیشه خاتمه می‌یابد و یک تطابق پایدار می‌یابد.
\item[-]
\textbf{اثبات:}
 ابتدا نشان می‌دهیم که حلقه‌ی while همواره خاتمه می‌یابد. اثبات با روش تناقض انجام می‌شود. اگر این حلقه خاتمه نیابد، دلیل آن این است که برخی از زنان آزاد باقی می‌مانند. برای آنکه زنی آزاد باقی بماند، باید به تمام مردان پیشنهاد داده باشد و از سوی همه آن‌ها رد شده باشد.
\item[-]
 برای اینکه مردی زنی را رد کند، باید پیش‌تر زوج شده باشد. بنابراین، تمام مردان مزدوج هستند. از آنجا که تعداد زنان و مردان برابر است، نتیجه می‌گیریم که همه‌ی زنان نیز زوج هستند. این به تناقض می‌انجامد، چرا که طبق فرض اولیه، برخی زنان آزاد بودند.
\end{itemframe}


\begin{itemframe}{مسئله ازدواج پایدار}
\item[-]
همچنین باید نشان دهیم این حلقه‌ تعداد بار محدودی اجرا می‌شود.
 از آن‌جا که هر یک از $n$ زن، فهرست ترجیحات خود از میان $n$ مرد را به ترتیب بررسی می‌کند‌(ممکن است تا انتهای فهرست نرسد) تعداد تکرار حلقه حداکثر برابر است با
$n^2$
.
\item[-]
اکنون باید نشان دهیم که هیچ زوج مسدودکننده‌ای وجود ندارد.
\item[-]
فرض کنید در تطابق نهایی زن $w$ با مرد $m$ زوج شده است، اما او مردی دیگر به نام $m'$ را ترجیح می‌دهد.
می‌خواهیم ثابت کنیم زوج $(w, m')$، مسدودکننده نیست، پس باید نشان دهیم $m'$ فرد $w$ را به شریک فعلی خود ترجیح نمی‌دهد.
\end{itemframe}


\begin{itemframe}{مسئله ازدواج پایدار}
\item[-]
ابتدا دقت کنید وقتی مردی مانند $m$ مزدوج شد، مزدوج باقی می‌ماند و هر بار که زوج خود را می‌شکند، به خاطر زنی است که او را ترجیح می‌دهد.
\item[-]
از آنجا که $w$ شخص $m'$ را به $m$ ترجیح می‌دهد، پس او باید پیش از پیشنهاد به $m$، به $m'$ پیشنهاد داده باشد؛ و $m'$ یا این پیشنهاد را رد کرده، یا ابتدا پذیرفته و سپس نامزدی را بر هم زده است.
\item[-]
اگر $m'$ پیشنهاد $w$ را رد کرده، پس در آن لحظه با زنی زوج بوده که او را به $w$ ترجیح می‌داده است.
 اگر $m'$ ابتدا پذیرفته و سپس نامزدی را بر هم زده، پس در برهه‌ای با $w$ زوج بوده اما بعدتر پیشنهاد زنی را پذیرفته که او را به $w$ ترجیح می‌داده است.
\item[-]
بنابراین، تطابق نهایی هیچ زوج مسدودکننده‌ای ندارد.
\end{itemframe}


\begin{itemframe}{مسئله ازدواج پایدار}
\item[-]
در مورد الگوریتم گیل-شپلی قضیه دیگری وجود دارد که بیان می‌کند: صرف‌نظر از ترتیب انتخاب زنان در خط ۲ این الگوریتم همواره یک تطابق یکسان بازمی‌گرداند، که در آن هر زن با بهترین شریک ممکن خود در میان تمامی تطابق‌های پایدار زوج می‌شود.

%todo to be continued
%todo mention that complexity is n^2
\end{itemframe}